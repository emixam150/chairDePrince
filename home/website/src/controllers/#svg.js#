exports.exec = function(support){
    var fs = require('fs');
    if(support.content !== null){
	support.res.setHeader('Cache-Control','public, max-age=' + support.page.maxAge );
	support.res.writeHead(200, {
	    'Content-Type': support.page.mime,
	    'Content-Length': support.content.length
	});
	support.res.end(support.content, 'binary');
	

    }else{
	fs.stat(support.ressourcePath, function(err, stat){
	    if(err){
		if('ENOENT' == err.code){
		    support.res.statusCode = 404;
		    support.res.end('Not Found');
		}else {
		    support.res.statusCode = 500;
		    support.res.end('Internal Server Error');
		}
	    }else{
		//creer un acces lecture vers l'image
		var stream = fs.createReadStream(support.ressourcePath),
		    contentLength = 0;
		

		support.res.writeHead(200, {
		    'Content-Type': support.page.mime,
		    'Content-Length': stat.size,
		    'Cache-Control':'public, max-age=' + support.page.maxAge
		});
		

		stream.pipe(support.res);

		stream.on('error', function(err){
		    support.res.statCode = 500;
	    	    support.res.end('Internal Server Error');
		});
	    }    
	});
    }
}


