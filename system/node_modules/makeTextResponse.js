var zlib = require('zlib');

exports.send = function(content,headers,res){
//    console.log("send");

	if(headers.acceptEncoding.indexOf('gzip') !== -1 ){
	    zlib.gzip(content,function(err, buffer) {
		if(!err){
		    if(!res.headersSent){
			res.setHeader("Content-Encoding", 'gzip');
			res.setHeader("Content-Length", buffer.length);
			res.end(buffer)
		    }else{

		    }
		}else{
		    res.setHeader("Content-Length", content.length);
		    res.end(content);
		}
	    });
	}else if(headers.acceptEncoding.indexOf('deflate') !== -1 ){
    	    zlib.deflate(content,function(err, buffer) {
    		if(!err){
		    if(!res.headersSent){
    			res.setHeader("Content-Encoding", 'deflate');
    			res.setHeader("Content-Length", buffer.length);
		    }
    		    res.end(buffer);
    		}else{
    		    res.setHeader("Content-Length", content.length);
    		    res.end(content);
    		}
    	    });
	}else {
    	    res.setHeader("Content-Length", content.length);
    	    res.end(content);
	}

}